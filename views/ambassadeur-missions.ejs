<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8"><title>Mes Missions | FORFEO LAB</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <style>body { background: #f4f7fb; font-family: 'Inter', sans-serif; } .card-mission { background: white; border-radius: 15px; padding: 20px; margin-bottom: 15px; }</style>
</head>
<body>
    <nav class="navbar bg-white border-bottom px-4"><a class="navbar-brand fw-bold text-primary" href="/ambassadeur/dashboard">FORFEO LAB</a></nav>
    <div class="container py-5">
        <h2 class="fw-bold mb-4">Suivi de mes Audits</h2>
        <% missions.forEach(m => { %>
            <div class="card-mission shadow-sm border-start border-4 <%= m.statut === 'reserve' ? 'border-warning' : 'border-success' %>">
                <div class="d-flex justify-content-between align-items-center">
                    <div><h5 class="fw-bold mb-0"><%= m.titre %></h5><small class="text-muted"><%= m.statut.toUpperCase() %> - <%= m.recompense %>$</small></div>
                    <% if(m.statut === 'reserve') { %>
                        <button class="btn btn-primary btn-sm rounded-pill px-4" data-bs-toggle="modal" data-bs-target="#modal<%= m.id %>">Rapport</button>
                    <% } else { %><span class="text-success small fw-bold">Envoyé</span><% } %>
                </div>
            </div>

            <div class="modal fade" id="modal<%= m.id %>" tabindex="-1"><div class="modal-dialog modal-lg"><div class="modal-content p-4 rounded-4">
                <h5 class="fw-bold mb-4">Envoyer mon rapport</h5>
                <form action="/envoyer-rapport" method="POST">
                    <input type="hidden" name="id_mission" value="<%= m.id %>">
                    <div class="mb-4 bg-light p-3 rounded small"><%= m.description %></div>
                    
                    <div class="mb-3"><label class="small fw-bold">Feedback Général</label>
                    <textarea name="feedback_general" class="form-control" rows="3" required></textarea></div>
                    
                    <div class="mb-4"><label class="small fw-bold text-primary"><i class="bi bi-camera"></i> Preuve visuelle (Lien Photo)</label>
                    <input type="url" name="photo_url" class="form-control" placeholder="Lien vers photo (Drive, iCloud...)" required></div>
                    
                    <button type="submit" class="btn btn-primary w-100 rounded-pill fw-bold">Soumettre l'Audit</button>
                </form>
            </div></div></div>
        <% }) %>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
