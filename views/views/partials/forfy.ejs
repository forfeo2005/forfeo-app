<div id="forfy-widget" style="position: fixed; bottom: 20px; right: 20px; z-index: 10000; font-family: sans-serif;">
    
    <div id="forfy-box" style="display:none; width:320px; height:450px; background:white; border-radius:15px; box-shadow:0 10px 40px rgba(0,0,0,0.2); flex-direction:column; overflow:hidden; margin-bottom:15px; border:1px solid #eee;">
        <div style="background:#000; color:white; padding:15px; font-weight:bold; display:flex; justify-content:space-between; align-items:center;">
            <span>ðŸ¤– Forfy Assistant</span>
            <span onclick="toggleForfy()" style="cursor:pointer; font-size:20px;">&times;</span>
        </div>
        <div id="chat-content" style="flex:1; padding:15px; overflow-y:auto; font-size:14px; background:#fdfdfd;">
            <div style="margin-bottom:10px; color:#555;">Bonjour ! Je suis Forfy. Comment puis-je vous aider aujourd'hui ?</div>
        </div>
        <div style="padding:10px; border-top:1px solid #eee; display:flex; background:white;">
            <input type="text" id="chat-input" placeholder="Posez une question..." style="flex:1; border:1px solid #ddd; border-radius:20px; padding:10px; outline:none;">
            <button onclick="sendChat()" style="background:#000; color:white; border:none; margin-left:8px; width:35px; height:35px; border-radius:50%; cursor:pointer;">âž¤</button>
        </div>
    </div>

    <button onclick="toggleForfy()" style="width:60px; height:60px; border-radius:50%; background:#000; color:white; border:none; font-size:30px; cursor:pointer; box-shadow:0 4px 15px rgba(0,0,0,0.3); display:flex; align-items:center; justify-content:center;">
        ðŸ¤–
    </button>
</div>

<script>
    function toggleForfy() {
        const box = document.getElementById('forfy-box');
        box.style.display = box.style.display === 'none' ? 'flex' : 'none';
        if(box.style.display === 'flex') document.getElementById('chat-input').focus();
    }

    async function sendChat() {
        const input = document.getElementById('chat-input');
        const content = document.getElementById('chat-content');
        const msg = input.value.trim();
        if(!msg) return;

        content.innerHTML += `<div style="text-align:right; margin-bottom:10px;"><strong>Moi:</strong> \${msg}</div>`;
        input.value = '';
        content.scrollTop = content.scrollHeight;

        try {
            const res = await fetch('/api/chat', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({message: msg})
            });
            const data = await res.json();
            content.innerHTML += `<div style="margin-bottom:10px; color:#444;"><strong>Forfy:</strong> \${data.reply}</div>`;
            content.scrollTop = content.scrollHeight;
        } catch (err) {
            content.innerHTML += `<div style="color:red; font-size:12px;">Erreur de connexion avec Forfy.</div>`;
        }
    }

    document.getElementById('chat-input')?.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') sendChat();
    });
</script>
