<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel | FORFEO LAB</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --bg-soft: #f8fafc; }
        body { background-color: var(--bg-soft); font-family: 'Inter', sans-serif; }
        .navbar-admin { background: #1e293b; color: white; padding: 15px 25px; }
        .glass-card { background: white; border-radius: 15px; padding: 20px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
        @media (max-width: 768px) {
            .table-responsive thead { display: none; }
            .table-responsive tr { display: block; background: white; margin-bottom: 10px; padding: 10px; border-radius: 10px; }
            .table-responsive td { display: flex; justify-content: space-between; border: none !important; }
            .table-responsive td::before { content: attr(data-label); font-weight: bold; }
        }
    </style>
</head>
<body>
    <nav class="navbar-admin d-flex justify-content-between align-items-center sticky-top">
        <span class="fw-bold">FORFEO ADMIN</span>
        <a href="/logout" class="btn btn-danger btn-sm rounded-pill">DÃ©connexion</a>
    </nav>

    <div class="container py-4">
        <div class="row g-3 mb-4">
            <div class="col-md-3">
                <div class="glass-card text-center">
                    <small class="text-muted">ENTREPRISES</small>
                    <h3 class="fw-bold m-0"><%= entreprises.length %></h3>
                </div>
            </div>
            <div class="col-md-9">
                <div class="glass-card bg-dark text-white">
                    <canvas id="revenueChart" style="max-height: 50px;"></canvas>
                </div>
            </div>
        </div>

        <div class="glass-card">
            <h5 class="fw-bold mb-4">Flux des Rapports</h5>
            <div class="table-responsive">
                <table class="table align-middle">
                    <thead><tr><th>MISSION</th><th>ENTREPRISE</th><th>STATUT</th><th class="text-end">ACTION</th></tr></thead>
                    <tbody>
                        <% rapports.forEach(r => { %>
                            <tr>
                                <td data-label="Mission"><%= r.titre %></td>
                                <td data-label="Entreprise"><%= r.entreprise_nom || 'Inconnue' %></td>
                                <td data-label="Statut"><span class="badge bg-<%= r.statut === 'approuve' ? 'success' : 'warning' %>"><%= r.statut %></span></td>
                                <td class="text-end">
                                    <% if(r.statut === 'termine') { %>
                                        <button class="btn btn-primary btn-sm rounded-pill">Valider</button>
                                    <% } %>
                                </td>
                            </tr>
                        <% }) %>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        const ctx = document.getElementById('revenueChart').getContext('2d');
        new Chart(ctx, {
            type: 'line',
            data: {
                labels: <%- JSON.stringify(chartData.map(d => d.mois)) %>,
                datasets: [{ data: <%- JSON.stringify(chartData.map(d => d.total)) %>, borderColor: '#fbbf24', tension: 0.4 }]
            },
            options: { plugins: { legend: { display: false } }, scales: { x: { display: false }, y: { display: false } } }
        });
    </script>
</body>
</html>
