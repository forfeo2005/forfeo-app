<div id="forfy-container" style="position: fixed; bottom: 30px; right: 30px; z-index: 9999; font-family: 'Inter', sans-serif;">
    
    <div class="forfy-help-bubble">Besoin d'aide ?</div>

    <button onclick="toggleChat()" id="forfy-trigger" style="width: 70px; height: 70px; border-radius: 50%; border: 3px solid white; background: white; box-shadow: 0 4px 20px rgba(0,0,0,0.3); overflow: hidden; cursor: pointer; transition: transform 0.3s ease;">
        <video src="/videos/GifForfy.MP4" autoplay loop muted playsinline style="width: 100%; height: 100%; object-fit: cover;"></video>
    </button>

    <div id="forfy-window" style="display: none; position: absolute; bottom: 90px; right: 0; width: 320px; height: 450px; background: white; border-radius: 20px; box-shadow: 0 10px 40px rgba(0,0,0,0.2); flex-direction: column; overflow: hidden; border: 1px solid #f0f0f0;">
        <div style="background: #0061ff; color: white; padding: 15px; display: flex; align-items: center; justify-content: space-between;">
            <div style="display: flex; align-items: center; gap: 10px;">
                <div style="width: 35px; height: 35px; background: white; border-radius: 50%; overflow: hidden;"><video src="/videos/GifForfy.MP4" autoplay loop muted playsinline style="width: 100%; height: 100%; object-fit: cover;"></video></div>
                <div><div style="font-weight: 700; font-size: 14px;">Forfy Assistant</div><div style="font-size: 10px; opacity: 0.9;">IA Connect√©e</div></div>
            </div>
            <button onclick="toggleChat()" style="background: none; border: none; color: white; font-size: 24px; cursor: pointer;">√ó</button>
        </div>
        <div id="forfy-messages" style="flex: 1; padding: 15px; overflow-y: auto; background: #f8fafc; display: flex; flex-direction: column; gap: 10px;">
            <div style="align-self: flex-start; max-width: 85%;"><div style="background: white; padding: 10px; border-radius: 12px 12px 12px 0; border: 1px solid #e2e8f0; font-size: 13px; color: #333;">Bonjour ! Je suis Forfy üê∂. Comment puis-je vous aider aujourd'hui ?</div></div>
        </div>
        <div style="padding: 12px; background: white; border-top: 1px solid #eee; display: flex; gap: 8px;">
            <input type="text" id="forfy-input" placeholder="√âcrivez ici..." style="flex: 1; border: 1px solid #e2e8f0; border-radius: 20px; padding: 8px 12px; outline: none; font-size: 13px;">
            <button onclick="sendMessage()" style="width: 35px; height: 35px; border-radius: 50%; background: #0061ff; color: white; border: none; cursor: pointer;">‚û§</button>
        </div>
    </div>
</div>
<script>
    function toggleChat() { const win = document.getElementById('forfy-window'); win.style.display = (win.style.display === 'none' || win.style.display === '') ? 'flex' : 'none'; }
    const input = document.getElementById('forfy-input'); const chat = document.getElementById('forfy-messages');
    input.addEventListener('keypress', (e) => { if (e.key === 'Enter') sendMessage(); });
    async function sendMessage() {
        const txt = input.value.trim(); if (!txt) return;
        chat.innerHTML += `<div style="align-self: flex-end; max-width: 85%;"><div style="background: #0061ff; color: white; padding: 10px; border-radius: 12px 12px 0 12px; font-size: 13px;">${txt}</div></div>`;
        input.value = ''; chat.scrollTop = chat.scrollHeight;
        const loadId = 'load-' + Date.now(); chat.innerHTML += `<div id="${loadId}" style="align-self: flex-start; max-width: 85%;"><div style="background: white; padding: 8px; border-radius: 12px; border: 1px solid #eee; font-size: 11px; color: #888;">Forfy r√©fl√©chit...</div></div>`; chat.scrollTop = chat.scrollHeight;
        try { const res = await fetch('/api/chat', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ message: txt }) }); const data = await res.json(); document.getElementById(loadId).remove(); chat.innerHTML += `<div style="align-self: flex-start; max-width: 85%;"><div style="background: white; padding: 10px; border-radius: 12px 12px 12px 0; border: 1px solid #e2e8f0; font-size: 13px; color: #333;">${data.reply}</div></div>`; } catch (e) { document.getElementById(loadId).remove(); } chat.scrollTop = chat.scrollHeight;
    }
</script>
