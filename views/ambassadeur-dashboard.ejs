<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Ambassadeur | FORFEO</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="/css/premium-dashboard.css">
</head>
<body>
    <div class="premium-bg"></div>
    <div id="toast-container"></div>
    
    <div class="container py-5">
        <div class="d-flex justify-content-between align-items-center mb-5 reveal-up">
            <h3 class="fw-bold">Espace Ambassadeur</h3>
            <div class="d-flex gap-2">
                <span class="btn btn-light btn-sm disabled text-dark fw-bold"><%= userName %></span>
                <a href="/logout" class="btn btn-outline-danger btn-sm rounded-pill">Déconnexion</a>
            </div>
        </div>

        <div class="row g-4 mb-5">
            <div class="col-md-4">
                <div class="glass-card bg-primary text-white h-100 reveal-up delay-100" style="background: linear-gradient(135deg, #0061ff, #3b82f6);">
                    <div class="opacity-75 small fw-bold uppercase mb-1">Gains Totaux</div>
                    <div class="display-3 fw-bold mb-3"><span class="count-up"><%= totalGains %></span>$</div>
                    <div class="badge bg-white text-primary rounded-pill"><i class="bi bi-wallet2"></i> Payé mensuellement</div>
                </div>
            </div>
            
            <div class="col-md-8">
                <div class="glass-card h-100 d-flex align-items-center justify-content-around text-center reveal-up delay-200">
                    <div>
                        <div class="h2 fw-bold text-dark count-up"><%= historique.filter(h => h.statut === 'approuve').length %></div>
                        <div class="text-muted small">Missions Réussies</div>
                    </div>
                    <div class="vr opacity-25"></div>
                    <div>
                        <div class="h2 fw-bold text-warning count-up"><%= historique.filter(h => h.statut === 'reserve').length %></div>
                        <div class="text-muted small">En cours</div>
                    </div>
                    <div class="vr opacity-25"></div>
                    <div>
                        <i class="bi bi-trophy-fill text-warning fs-1 mb-2 d-block"></i>
                        <div class="badge bg-warning-subtle text-warning">Ambassadeur Certifié</div>
                    </div>
                </div>
            </div>
        </div>

        <h4 class="fw-bold mb-4 reveal-up delay-300">Missions Disponibles</h4>
        <div class="row g-4 mb-5">
            <% if(missions.length === 0) { %>
                <div class="col-12 text-center py-5 glass-card">
                    <p class="text-muted">Aucune mission disponible pour le moment.</p>
                </div>
            <% } %>
            <% missions.forEach(m => { %>
                <div class="col-md-6 col-lg-4 reveal-up">
                    <div class="glass-card h-100 d-flex flex-column">
                        <div class="d-flex justify-content-between mb-3">
                            <span class="badge bg-primary-subtle text-primary"><%= m.type_audit %></span>
                            <span class="fw-bold text-success"><%= m.recompense %>$</span>
                        </div>
                        <h5 class="fw-bold"><%= m.titre %></h5>
                        <p class="small text-muted flex-grow-1"><%= m.description.substring(0, 100) %>...</p>
                        <form action="/postuler-mission" method="POST" class="mt-3">
                            <input type="hidden" name="id_mission" value="<%= m.id %>">
                            <button class="btn btn-premium w-100 btn-sm">Postuler</button>
                        </form>
                    </div>
                </div>
            <% }) %>
        </div>
        
        <div class="glass-card reveal-up">
            <h5 class="fw-bold mb-4">Historique</h5>
            <div class="table-responsive">
                <table class="premium-table">
                    <thead><tr><th>Mission</th><th>Statut</th><th>Gain</th></tr></thead>
                    <tbody>
                        <% historique.forEach(h => { %>
                            <tr>
                                <td class="fw-bold"><%= h.titre %></td>
                                <td><span class="badge-status <%= h.statut %>"><%= h.statut %></span></td>
                                <td class="fw-bold"><%= h.recompense %>$</td>
                            </tr>
                        <% }) %>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <script src="/js/premium-ui.js"></script>
</body>
</html>
