<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Dashboard Performance | Forfeo</title>
    <link rel="stylesheet" href="/css/style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <nav>
        <div class="logo">FORFEO BUSINESS</div>
        <a href="/" class="btn-outline">Retour Accueil</a>
    </nav>

    <div class="container">
        <div class="card">
            <h2>Indice de Qualité Global</h2>
            <div style="height: 300px;">
                <canvas id="qualityChart"></canvas>
            </div>
        </div>

        <div class="card">
            <h2>Missions d'audit en cours</h2>
            <table>
                <thead>
                    <tr>
                        <th>Mission ID</th>
                        <th>Type</th>
                        <th>Statut</th>
                    </tr>
                </thead>
                <tbody>
                    <% if (missions && missions.length > 0) { %>
                        <% missions.forEach(m => { %>
                        <tr>
                            <td>#<%= m.id %></td>
                            <td><%= m.type_mission %></td>
                            <td><span class="badge"><%= m.statut %></span></td>
                        </tr>
                        <% }) %>
                    <% } else { %>
                        <tr><td colspan="3">Aucune donnée disponible pour le moment.</td></tr>
                    <% } %>
                </tbody>
            </table>
        </div>
    </div>

    <script>
        const ctx = document.getElementById('qualityChart').getContext('2d');
        const statsData = <%- JSON.stringify(stats || []) %>;
        
        new Chart(ctx, {
            type: 'line',
            data: {
                labels: statsData.length > 0 ? statsData.map((_, i) => 'Audit ' + (i+1)) : ['En attente'],
                datasets: [{
                    label: 'Score Global',
                    data: statsData.length > 0 ? statsData.map(s => (s.score_accueil + s.score_service + s.score_proprete)/3) : [0],
                    borderColor: '#0052cc',
                    tension: 0.3,
                    fill: true,
                    backgroundColor: 'rgba(0, 82, 204, 0.1)'
                }]
            },
            options: { responsive: true, maintainAspectRatio: false }
        });
    </script>
</body>
</html>
